import{M as T}from"./bootstrap.esm-TTjMTX3M.js";import{_ as B,o as n,c as i,a as t,t as d,F as S,g as V,h as c,i as w,v as M,b as m,w as P,r as x,n as U,d as b,j as k}from"./index-f2w02a_B.js";import{a as h}from"./axios-L6U4YIEh.js";import{S as q}from"./main-Pn7BM_i8.js";const $={props:["product"],data(){return{modalInModalComponent:"",qty:1}},methods:{},mounted(){this.modalInModalComponent=new T(this.$refs.productModalRef,{backdrop:"static"})}},D={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"productModalRef"},A={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},E={class:"modal-title",id:"exampleModalLabel"},F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),L={class:"modal-body"},j={class:"row"},O={class:"col-sm-6"},R=["src"],G={class:"col-sm-6"},H={class:"badge bg-primary rounded-pill"},J={key:0,class:"h5"},K={key:1,class:"h6"},Q={key:2,class:"h5"},W={class:"input-group"};function X(a,e,l,u,o,_){return n(),i("div",D,[t("div",A,[t("div",z,[t("div",N,[t("h5",E,[t("span",null,d(l.product.title),1)]),F]),t("div",L,[t("div",j,[t("div",O,[(n(!0),i(S,null,V(l.product.imagesUrl,f=>(n(),i("img",{class:"img-fluid",src:f,alt:"",key:f.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,R))),128))]),t("div",G,[t("span",H,d(l.product.category),1),t("p",null,"商品描述："+d(l.product.description),1),t("p",null,"商品內容："+d(l.product.content),1),l.product.price?c("",!0):(n(),i("div",J,d(l.product.origin_price)+" 元",1)),l.product.price?(n(),i("del",K,"原價 "+d(l.product.origin_price)+" 元",1)):c("",!0),l.product.price?(n(),i("div",Q,"現在只要 "+d(l.product.price)+" 元",1)):c("",!0),t("div",null,[t("div",W,[w(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=f=>o.qty=f),min:"1"},null,512),[[M,o.qty,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=f=>a.$emit("add-to-cart",l.product.id,o.qty))},"加入購物車(內)")])])])])])])])],512)}const Y=B($,[["render",X]]),v=q.mixin({toast:!0,position:"center",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:1500,timerProgressBar:!0}),p="https://ec-course-api.hexschool.io/v2",g="aca101139",Z={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{}}},methods:{getProducts(){const a=`${p}/api/${g}/products/all`;h.get(a).then(e=>{this.products=e.data.products}).catch(e=>{alert(e.response.data.message)})},getProduct(a){const e=`${p}/api/${g}/product/${a}`;this.loadingStatus.loadingItem=a,h.get(e).then(l=>{this.loadingStatus.loadingItem="",this.product=l.data.product,this.$refs.userProductModal.modalInModalComponent.show(),this.$refs.userProductModal.qty=1}).catch(l=>{alert(l)})},addToCart(a,e=1){const l=`${p}/api/${g}/cart`;this.loadingStatus.loadingItem=a;const u={product_id:a,qty:e};this.$refs.userProductModal.modalInModalComponent.hide(),h.post(l,{data:u}).then(o=>{this.loadingStatus.loadingItem="",this.getCart(),v.fire({icon:"success",title:"已加入購物車"})}).catch(o=>{alert(o.response.data.message)})},updateCart(a){this.loadingStatus.loadingItem=a.id;const e=`${p}/api/${g}/cart/${a.id}`,l={product_id:a.product_id,qty:a.qty};h.put(e,{data:l}).then(u=>{alert(u.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(u=>{alert(u.response.data.message),this.loadingStatus.loadingItem=""})},deleteAllCarts(){q.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(e=>{e.isConfirmed?(v.fire({icon:"warning",title:"刪除成功"}),h.delete(a).then(()=>{this.getCart()}).catch(l=>{alert(l.response.data.message)})):e.isDenied&&v.fire({icon:"info",title:"已為您保留購物車內容"})}).catch(()=>{alert("伺服器錯誤")});const a=`${p}/api/${g}/carts`},getCart(){const a=`${p}/api/${g}/cart`;h.get(a).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.response.data.message)})},removeCartItem(a){q.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(l=>{l.isConfirmed?(v.fire({icon:"warning",title:"刪除成功"}),h.delete(e).then(u=>{this.loadingStatus.loadingItem="",this.getCart()}).catch(u=>{alert(u.response.data.message)})):l.isDenied&&v.fire({icon:"info",title:"已為您保留該品項"})});const e=`${p}/api/${g}/cart/${a}`;this.loadingStatus.loadingItem=a},createOrder(){if(this.cart.carts.length===0)alert("購物車內沒有品項");else{const a=`${p}/api/${g}/order`,e=this.form;h.post(a,{data:e}).then(l=>{alert(l.data.message),this.$refs.form.resetForm(),this.getCart()}).catch(l=>{alert(l.response.data.message)})}}},mounted(){this.getProducts(),this.getCart()},components:{userProductModal:Y}},tt={class:"container"},et={class:"mt-4"},st={class:"table align-middle"},ot=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),lt={style:{width:"200px"}},at={key:0,class:"h5"},nt={key:1,class:"h6"},it={key:2,class:"h5"},dt={class:"btn-group btn-group-sm"},rt=["onClick","disabled"],ct={key:0,class:"fas fa-spinner fa-pulse"},ut=["onClick","disabled"],mt={key:0,class:"fas fa-spinner fa-pulse"},_t={class:"text-end"},ht={key:0},pt={key:1},gt=t("h3",null,"目前購物車沒有品項",-1),ft=[gt],bt={class:"table align-middle"},vt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),yt=["onClick","disabled"],Ct={key:0,class:"fas fa-spinner fa-pulse"},xt=t("div",{class:"text-success"},"已套用優惠券",-1),kt={class:"input-group input-group-sm"},St={class:"input-group mb-3"},Vt=["onUpdate:modelValue","onBlur","disabled"],wt={class:"input-group-text",id:"basic-addon2"},Mt={class:"text-end"},qt={key:0,class:"text-success"},Bt=t("td",{colspan:"3",class:"text-end"},"總計",-1),It={class:"text-end"},Tt={key:0},Pt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Ut={class:"text-end text-success"},$t={class:"my-5 row justify-content-center"},Dt={class:"mb-3"},At=t("label",{for:"email",class:"form-label"},"Email",-1),zt={class:"mb-3"},Nt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Et={class:"mb-3"},Ft=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Lt={class:"mb-3"},jt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Ot={class:"mb-3"},Rt=t("label",{for:"message",class:"form-label"},"留言",-1),Gt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function Ht(a,e,l,u,o,_){const f=x("user-product-modal"),y=x("v-field"),C=x("error-message"),I=x("v-form");return n(),i("div",tt,[t("div",et,[m(f,{product:o.product,ref:"userProductModal",onAddToCart:_.addToCart},null,8,["product","onAddToCart"]),t("table",st,[ot,t("tbody",null,[(n(!0),i(S,null,V(o.products,s=>(n(),i("tr",{key:s.id},[t("td",lt,[t("div",{style:U([{height:"150px","background-size":"cover","background-repeat":"no-repeat"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),t("td",null,d(s.title),1),t("td",null,[s.price?c("",!0):(n(),i("div",at,d(s.origin_price)+" 元 ",1)),s.price?(n(),i("del",nt,"原價 "+d(s.origin_price)+" 元",1)):c("",!0),s.price?(n(),i("div",it," 現在只要 "+d(s.price)+" 元 ",1)):c("",!0)]),t("td",null,[t("div",dt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:r=>_.getProduct(s.id),disabled:o.loadingStatus.loadingItem===s.id||!s.is_enabled},[o.loadingStatus.loadingItem===s.id?(n(),i("i",ct)):c("",!0),b(" 查看更多 ")],8,rt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:r=>_.addToCart(s.id),disabled:o.loadingStatus.loadingItem===s.id||!s.is_enabled},[o.loadingStatus.loadingItem===s.id?(n(),i("i",mt)):c("",!0),b(" 加到購物車 ")],8,ut)])])]))),128))])]),t("div",_t,[o.cart.carts&&o.cart.carts.length!==0?(n(),i("div",ht,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...s)=>_.deleteAllCarts&&_.deleteAllCarts(...s))}," 清空購物車 ")])):(n(),i("div",pt,ft))]),t("table",bt,[vt,t("tbody",null,[o.cart.carts?(n(!0),i(S,{key:0},V(o.cart.carts,s=>(n(),i("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>_.removeCartItem(s.id),disabled:o.loadingStatus.loadingItem===s.id},[o.loadingStatus.loadingItem===s.id?(n(),i("i",Ct)):c("",!0),b(" x ")],8,yt)]),t("td",null,[b(d(s.product.title)+" ",1),xt]),t("td",null,[t("div",kt,[t("div",St,[w(t("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":r=>s.qty=r,onBlur:r=>_.updateCart(s),disabled:o.loadingStatus.loadingItem===s.id},null,40,Vt),[[M,s.qty,void 0,{number:!0}]]),t("span",wt,d(s.product.unit),1)])])]),t("td",Mt,[s.final_total!==s.total?(n(),i("small",qt,"折扣價：")):c("",!0),b(" "+d(s.final_total),1)])]))),128)):c("",!0)]),t("tfoot",null,[t("tr",null,[Bt,t("td",It,d(o.cart.total),1)]),o.cart.final_total!==o.cart.total?(n(),i("tr",Tt,[Pt,t("td",Ut,d(o.cart.final_total),1)])):c("",!0)])])]),t("div",$t,[m(I,{ref:"form",class:"col-md-6",onSubmit:_.createOrder},{default:P(({errors:s})=>[t("div",Dt,[At,m(y,{id:"email",name:"email",type:"email",class:k(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.user.email=r)},null,8,["class","modelValue"]),m(C,{name:"email",class:"invalid-feedback"})]),t("div",zt,[Nt,m(y,{id:"name",name:"姓名",type:"text",class:k(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.user.name=r)},null,8,["class","modelValue"]),m(C,{name:"姓名",class:"invalid-feedback"})]),t("div",Et,[Ft,m(y,{id:"tel",name:"電話",type:"tel",class:k(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.user.tel=r)},null,8,["class","modelValue"]),m(C,{name:"電話",class:"invalid-feedback"})]),t("div",Lt,[jt,m(y,{id:"address",name:"地址",type:"text",class:k(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.user.address=r)},null,8,["class","modelValue"]),m(C,{name:"地址",class:"invalid-feedback"})]),t("div",Ot,[Rt,w(t("textarea",{name:"message",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=r=>o.form.message=r)},null,512),[[M,o.form.message]])]),Gt]),_:1},8,["onSubmit"])])])}const Xt=B(Z,[["render",Ht]]);export{Xt as default};
